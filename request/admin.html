<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ê´€ë¦¬ì í˜ì´ì§€</title>
    <link rel="stylesheet" as="style" crossorigin
        href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" />
    <link rel="icon" href="/favicon.png">
    <style>
        body {
            text-align: center;
            font-family: "Pretendard", sans-serif;
            margin: 0;
            padding: 0;
        }

        h1 {
            margin: 20px 0;
        }

        .entry {
            position: relative;
            border: 1px solid #ccc;
            border-radius: 8px;
            margin: 10px auto;
            padding: 15px;
            width: 90%;
            max-width: 600px;
            text-align: left;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .entry h3 {
            margin: 0 0 10px;
        }

        .entry p {
            margin: 0;
        }

        .delete-icon {
            position: absolute;
            top: 10px;
            right: 10px;
            cursor: pointer;
            font-size: 18px;
            color: #f00;
        }

        .delete-icon:hover {
            color: #d00;
        }

        textarea {
            width: calc(100% - 20px);
            margin: 10px 0;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        button {
            padding: 10px;
            border: none;
            background-color: #007bff;
            color: #fff;
            border-radius: 4px;
            cursor: pointer;
        }

        button:hover {
            background-color: #0056b3;
        }

        /* ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ ìŠ¤íƒ€ì¼ */
        .password-container {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #f0f0f0;
        }

        .password-container input {
            padding: 10px;
            margin: 10px 0;
            font-size: 16px;
            border-radius: 4px;
            border: 1px solid #ccc;
        }

        .password-container button {
            background-color: #28a745;
        }

        .password-container button:hover {
            background-color: #218838;
        }
    </style>
</head>

<body>
    <div id="password-container" class="password-container">
        <h2>ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ ì…ë ¥</h2>
        <input type="password" id="password" placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”" />
        <button onclick="checkPassword()">í™•ì¸</button>
    </div>

    <div id="admin-container" style="display: none;">
        <h1>ê´€ë¦¬ì í˜ì´ì§€</h1>
        <div id="entries-container"></div>

        <!-- Firebase Configuration -->
        <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
        <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
        <script>
            // Firebase ì„¤ì •
            const firebaseConfig = {
                apiKey: "AIzaSyAmqNS5JpDe9XSgdMXJI0ju626RaA7av-4",
                authDomain: "weflash-0153.firebaseapp.com",
                databaseURL: "https://weflash-0153-default-rtdb.firebaseio.com",
                projectId: "weflash-0153",
                storageBucket: "weflash-0153.firebasestorage.app",
                messagingSenderId: "1089313427482",
                appId: "1:1089313427482:web:0e75055ddfca55dd8341a3",
            };

            // Firebase ì´ˆê¸°í™”
            const app = firebase.initializeApp(firebaseConfig);
            const database = firebase.database();

            async function loadEntries() {
                const entriesRef = database.ref("entries");
                entriesRef.on("value", (snapshot) => {
                    const entries = snapshot.val();
                    const entriesContainer = document.getElementById("entries-container");
                    entriesContainer.innerHTML = ""; // ê¸°ì¡´ í•­ëª© ë¹„ìš°ê¸°
                    if (entries) {
                        // í•­ëª©ì„ íƒ€ì„ìŠ¤íƒ¬í”„ ê¸°ì¤€ìœ¼ë¡œ ë‚´ë¦¼ì°¨ìˆœ ì •ë ¬
                        const sortedEntries = Object.entries(entries).sort(
                            ([, a], [, b]) => b.timestamp - a.timestamp
                        );

                        sortedEntries.forEach(([id, entry]) => {
                            const entryElement = document.createElement("div");
                            entryElement.className = "entry";
                            entryElement.innerHTML = `
                                <span class="delete-icon" onclick="deleteEntry('${id}')">ğŸ—‘ï¸</span>
                                <h3>${entry.name}</h3>
                                <p>${entry.message}</p>
                                <div id="comments-${id}">
                                    ${entry.comment ? `<strong>ê´€ë¦¬ì:</strong> ${entry.comment}` : ""}
                                </div>
                                <textarea id="comment-input-${id}" placeholder="ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
                                <button onclick="addComment('${id}')">ëŒ“ê¸€ ì‘ì„±</button>
                            `;
                            entriesContainer.appendChild(entryElement);
                        });
                    }
                });
            }

            async function addComment(entryId) {
                const commentInput = document.getElementById(`comment-input-${entryId}`);
                const commentText = commentInput.value.trim();

                if (commentText) {
                    if (confirm("ëŒ“ê¸€ì„ ë“±ë¡í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
                        await database.ref(`entries/${entryId}`).update({ comment: commentText });
                        commentInput.value = ""; // í…ìŠ¤íŠ¸ ì˜ì—­ ë¹„ìš°ê¸°
                        console.log("Comment added to entry:", entryId);
                    }
                } else {
                    alert("ëŒ“ê¸€ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
                }
            }

            async function deleteEntry(entryId) {
                if (confirm("ì •ë§ë¡œ ì´ í•­ëª©ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
                    await database.ref(`entries/${entryId}`).remove();
                    console.log("Entry deleted:", entryId);
                }
            }

            document.addEventListener("DOMContentLoaded", loadEntries);
        </script>
    </div>

    <script>
        // ë¹„ë°€ë²ˆí˜¸ í™•ì¸ í•¨ìˆ˜
        function checkPassword() {
            const enteredPassword = document.getElementById("password").value;
            const correctPassword = "0153";

            if (enteredPassword === correctPassword) {
                // ë¹„ë°€ë²ˆí˜¸ê°€ ë§ìœ¼ë©´ ê´€ë¦¬ì í˜ì´ì§€ í‘œì‹œ
                document.getElementById("password-container").style.display = "none";
                document.getElementById("admin-container").style.display = "block";
            } else {
                alert("ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.");
            }
        }
    </script>
</body>

</html>